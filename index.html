<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.9.1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!-- BEGIN opengraph metadata -->
    <meta property="og:title" content="libCloudSync" />
    <meta property="og:description" content="A simple to use C++ interface to interact with cloud storage providers." />
    <meta property="og:url" content="https://jothepro.github.io/libcloudsync/" />
    <!-- END opengraph metadata -->
    <!-- BEGIN twitter metadata -->
    <meta name="twitter:title" content="libCloudSync" />
    <meta name="twitter:description" content="A simple to use C++ interface to interact with cloud storage providers." />
    <!-- END twitter metadata -->
    <title>libCloudSync: libCloudSync</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <link rel="icon" type="image/svg+xml" href="logo.drawio.svg">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/jothepro/libcloudsync" class="github-corner" title="View source on GitHub">
    <svg viewBox="0 0 250 250" style="position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
            <tbody>
            <tr style="height: 56px;">
                <td id="projectlogo"><img alt="Logo" src="logo.drawio.svg"/></td>
                <td id="projectalign" style="padding-left: 0.5em;">
                    <div id="projectname">libCloudSync
                        &#160;<span id="projectnumber">v0.1.0</span>
                    </div>
                    <div id="projectbrief">Access Cloud Storage from C++</div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">libCloudSync </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> <a href="https://github.com/jothepro/libcloudsync/releases/latest"><img src="https://img.shields.io/github/v/release/jothepro/libcloudsync" alt="GitHub release (latest by date)" class="inline"/></a> <a href="https://github.com/jothepro/libcloudsync/blob/main/LICENSE"><img src="https://img.shields.io/github/license/jothepro/libcloudsync" alt="GitHub" class="inline"/></a></p>
<p>A simple-to-use C++ interface to interact with cloud storage providers.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Features</h1>
<ul>
<li>☁️ Supported Cloud Providers:<ul>
<li>Nextcloud</li>
<li>Dropbox</li>
<li>Onedrive</li>
<li>GDrive</li>
<li>WebDav</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Installation</h1>
<p>To use this library in you project, you can install it in the following ways:</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Conan</h2>
<div class="fragment"><div class="line"># Add conan remote:</div>
<div class="line">conan remote add gitlab-cloudsync https://gitlab.com/api/v4/projects/15425736/packages/conan</div>
</div><!-- fragment --><div class="fragment"><div class="line">[requires]</div>
<div class="line">libcloudsync/0.0.1@jothepro/stable</div>
</div><!-- fragment --><p>If you don't want to build &amp; run tests when building from source, set the <a href="https://docs.conan.io/en/latest/reference/env_vars.html#conan-run-tests">CONAN_RUN_TESTS</a> variable: </p><div class="fragment"><div class="line">conan install -if build --build missing . -e CONAN_RUN_TESTS=0</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Quick start</h1>
<div class="fragment"><div class="line"><span class="comment">// if this is the users first login, provide the authorization code to get a fresh access_token &amp; refresh_token</span></div>
<div class="line"><span class="keyword">auto</span> credentials = OAuth2Credentials::from_authorization_code(client_id, authorization_code, redirect_uri, code_verifier);</div>
<div class="line"><span class="comment">// if you already have an access token that is still valid, create a session that will automatically refresh when the token gets outdated</span></div>
<div class="line"><span class="keyword">auto</span> credentials = OAuth2Credentials::from_access_token(access_token, refresh_token, valid_until);</div>
<div class="line"><span class="comment">// if the access_token that you stored is already expired, just initialize with the refresh token, it will get a new access_token for you</span></div>
<div class="line"><span class="keyword">auto</span> credentials = OAuth2Credentials::from_refresh_token(refresh_token);</div>
<div class="line"><span class="comment">// listen on any token update. This will be called with a fresh access_token &amp; refresh_token if you just provided an authorization_code.</span></div>
<div class="line"><span class="comment">// Otherwise just the access_token will change and the refresh token will be unchanged</span></div>
<div class="line">credentials-&gt;on_token_update([<span class="keyword">this</span>](<span class="keyword">const</span> std::string&amp; access_token, std::chrono::time_point expires, <span class="keyword">const</span> std::string&amp; refresh_token){</div>
<div class="line">    <span class="comment">// store the new access_token/refresh_token </span></div>
<div class="line">})</div>
<div class="line"><span class="keyword">auto</span> cloud = CloudFactory().create_dropbox(credentials);</div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    <span class="keyword">auto</span> root_directory = cloud-&gt;root();</div>
<div class="line">    root_directory-&gt;get_file(<span class="stringliteral">&quot;test.txt&quot;</span>);</div>
<div class="line">} <span class="keywordflow">catch</span>(<span class="keyword">const</span> CloudException &amp;e) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Sth went wrong: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">auto</span> credentials = BasicCredentials::from_username_password(<span class="stringliteral">&quot;john&quot;</span>, <span class="stringliteral">&quot;password123&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> cloud = CloudFactory().create_nextcloud(<span class="stringliteral">&quot;nextcloud.com&quot;</span>, credentials);</div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    <span class="keyword">auto</span> file = cloud-&gt;root()-&gt;create_file(<span class="stringliteral">&quot;test.txt&quot;</span>);</div>
<div class="line">} <span class="keywordflow">catch</span>(<span class="keyword">const</span> CloudException &amp;e) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Sth went wrong: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Development</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
Build Requirements</h2>
<ul>
<li>Conan &gt;= 1.40</li>
<li>CMake &gt;= 3.15</li>
<li>Doxygen &gt;= 1.9.1 (optional)</li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
Build</h2>
<ul>
<li><b>Commandline</b>: <div class="fragment"><div class="line"># install dependencies with Conan</div>
<div class="line">conan install -if build --build missing .</div>
<div class="line"># configure, build &amp; test with Conan</div>
<div class="line">conan build -bf build .</div>
<div class="line"># or configure &amp; build directly with CMake</div>
<div class="line">cmake -S . -B build &amp;&amp; cmake --build build</div>
<div class="line"># and execute the tests with ctest</div>
<div class="line">ctest --test-dir build/test</div>
</div><!-- fragment --></li>
<li><b>Clion</b>: Install the <a href="https://plugins.jetbrains.com/plugin/11956-conan">Conan Plugin</a> before configuring &amp; building the project as usual.</li>
</ul>
<h2><a class="anchor" id="autotoc_md8"></a>
Test</h2>
<p>This library uses <a href="https://github.com/catchorg/Catch2">Catch2</a> for testing. The Unit-tests are defined in <code>test</code>.</p>
<ul>
<li><b>Commandline</b>: To run just the unit-tests, you can run <code>conan build -bf build --test .</code>.</li>
<li><b>CLion</b>: Execute the <code>CloudSyncTest</code> target</li>
</ul>
<h2><a class="anchor" id="autotoc_md9"></a>
Integration Test</h2>
<p>To ensure that the library behaves consistently with all cloud providers, the integration test runs a series of filesystem operations and checks for the correct results while being connected to the real cloud provider.</p>
<p>To execute the tests you need to provide valid credentials to an account for each of the supported providers.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Example CLI</h2>
<p>A small CLI example implementation is provided, to show the capabilities of the library.</p>
<div class="fragment"><div class="line"># build the example </div>
<div class="line">cmake --build build --target CloudSyncExample</div>
<div class="line"># execute the program</div>
<div class="line">cd build/example</div>
<div class="line">./CloudSyncExample --help</div>
<div class="line"># usage example: connect to a dropbox app folder</div>
<div class="line">./CloudSyncExample --dropbox --token &lt;your-access-token&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md11"></a>
Using the example CLI</h3>
<h4><a class="anchor" id="autotoc_md12"></a>
GDrive</h4>
<ol type="1">
<li>Get an access token from the <a href="https://developers.google.com/oauthplayground">OAuth 2.0 Playground</a> with the following permissions:<ul>
<li><code><a href="https://www.googleapis.com/auth/userinfo.profile">https://www.googleapis.com/auth/userinfo.profile</a></code> for loading the user profile.</li>
<li><code><a href="https://www.googleapis.com/auth/drive">https://www.googleapis.com/auth/drive</a></code> if you want access to your whole gdrive space.</li>
<li>or <code><a href="https://www.googleapis.com/auth/drive.appdata">https://www.googleapis.com/auth/drive.appdata</a></code> if you want access an the OAuth 2.0 Playground appfolder.</li>
</ul>
</li>
<li>When calling the <code>CloudSyncExample</code>, provide which root you want to access. Must match the permissions you requested: <div class="fragment"><div class="line">./CloudSyncExample --gdrive --root=&lt;root/appDataFolder&gt; --token=&lt;access_token&gt;</div>
</div><!-- fragment --></li>
</ol>
<h4><a class="anchor" id="autotoc_md13"></a>
Nextcloud</h4>
<ol type="1">
<li>Create an app-password for your session.</li>
<li>Call <code>CloudSyncExample</code> with the domain, username and the app-password: <div class="fragment"><div class="line">./CloudSyncExample --nextcloud --domain=https://&lt;your_domain&gt; --username=&lt;username&gt; --password=&lt;app-password&gt;</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md14"></a>
Documentation</h2>
<p>This project uses <a href="https://www.doxygen.nl/index.html">Doxygen</a> for documentation.</p>
<p>To generate the docs, run <code>doxygen Doxyfile</code> or execute the <code>doxygen</code> target defined in the <code>CMakeLists.txt</code>.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
CI/CD</h2>
<p>This template uses <a href="https://github.com/features/actions">Github Actions</a> for automating the release of a new library version.</p>
<ul>
<li>The workflow <code>configureBuildTestCreateAndUpload.yaml</code> configures, builds, tests the library automatically on each push. When a new release is created in Github, the resulting artifact is automatically uploaded to <a href="https://gitlab.com/jothepro/libcloudsync/-/packages">a public artifactory repository</a></li>
<li>The workflow <code>publish-pages.yaml</code> automatically builds and publishes the documentation to <a href="https://jothepro.github.io/libcloudsync/">Github Pages</a> when a new release is created in Github.</li>
</ul>
<h2><a class="anchor" id="autotoc_md16"></a>
Coding Conventions</h2>
<p>The C++ code should follow a derivation of <a href="https://github.com/lefticus/cppbestpractices/blob/master/03-Style.md">cppbestpractices code style</a>:</p>
<ul>
<li>Types start with upper case and are CamelCase: <code>MyClass</code></li>
<li>Functions and variables are snake_case: <code>my_method</code></li>
<li>Constants are all upper case: <code>const double PI=3.14159265358979323;</code></li>
<li>Name private data with a <code>m_</code> prefix to distinguish it from public data. <code>m_</code> stands for "member" data</li>
<li>Never use <code>using namespace</code> in a header file</li>
<li><code>{}</code> are required for blocks.</li>
<li>Use <code>""</code> for including local files, <code>&lt;&gt;</code> is reserved for system includes</li>
<li>Initialize member variables with the member initializer list</li>
<li>Always use namespaces</li>
<li>Use <code>.hpp</code> and <code>.cpp</code> for your file extensions</li>
<li>mark single parameter constructors as <code>explicit</code>, which requires them to be explicitly called.</li>
<li>do not provide any of the functions that the compiler can provide (copy constructor, copy assignment operator, move constructor, move assignment operator, destructor) unless the class you are constructing does some novel form of ownership.</li>
<li>Indentation is 4 spaces</li>
</ul>
<h1><a class="anchor" id="autotoc_md17"></a>
Useful Links</h1>
<h2><a class="anchor" id="autotoc_md18"></a>
API Documentation</h2>
<ul>
<li><a href="https://www.dropbox.com/developers/documentation/http/documentation">Dropbox</a></li>
<li><a href="https://docs.microsoft.com/en-us/onedrive/developer/rest-api/">OneDrive</a></li>
<li><a href="https://developers.google.com/drive/api/v2/about-sdk">GDrive</a></li>
<li><a href="https://docs.nextcloud.com/server/18/developer_manual/client_apis/WebDAV/index.html">Nextcloud</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md19"></a>
Getting developer tokens</h2>
<h3><a class="anchor" id="autotoc_md20"></a>
Dropbox</h3>
<p>Visit <a href="https://www.dropbox.com/developers/apps"><code>https://www.dropbox.com/developers/apps</code></a> and create a new app. In the tab <code>Settings</code> under the section <code>OAuth 2</code> there is a button to create an access token. It seems to be valid infinitely.</p>
<h3><a class="anchor" id="autotoc_md21"></a>
OneDrive</h3>
<p>Create an app in the <a href="https://portal.azure.com/">Azure Portal</a>. Copy the client-Id from the 'General'-Section. Follow <a href="https://docs.microsoft.com/en-us/onedrive/developer/rest-api/getting-started/graph-oauth?view=odsp-graph-online">these</a> instructions to obtain a token.</p>
<h3><a class="anchor" id="autotoc_md22"></a>
GDrive</h3>
<p>Go to <code><a href="https://developers.google.com/oauthplayground">https://developers.google.com/oauthplayground</a></code>, select the required scope, e.g. <code><a href="https://www.googleapis.com/auth/drive.appdata">https://www.googleapis.com/auth/drive.appdata</a></code> and let the tool do its job.</p>
<h3><a class="anchor" id="autotoc_md23"></a>
Nextcloud</h3>
<p>Does not support OAuth2, requires Username/Password login.</p>
<p>In your Nextcloud installation go to <code>settings</code> &gt; <code>user</code> &gt; <code>security</code> to create a specific app-password (recommended).</p>
<h1><a class="anchor" id="autotoc_md24"></a>
Roadmap</h1>
<ul>
<li>Implement equality operators for Cloud, Directory, File</li>
<li>Add tests for CURL wrapper (e.g. by going against a (mocked?) http server)</li>
<li>implementing support for big file upload/download (chunked upload/download)</li>
<li>Improve integration-test coverage</li>
<li>Improve unit-test coverage </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
